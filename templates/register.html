{% extends "base.html" %}

{% block title %}註冊{% endblock %}

{% block content %}
<div class="register-container">
  <h2 class="slide-up">🆕 建立新帳號</h2>
  <p class="slide-up delay-1">請填寫以下資訊以註冊新帳號。</p>

  <form id="register-form" method="POST" class="register-form slide-up delay-2">
    <div class="form-group">
      <label for="email">📧 電子郵件</label>
      <input type="email" name="email" id="email" class="form-control" required>
    </div>

    <div class="form-group">
      <label for="password">🔑 密碼</label>
      <input type="password" name="password" id="password" class="form-control" required 
             minlength="6" pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$" 
             title="密碼至少需要6個字元，且包含至少一個字母和一個數字">
      <small class="form-text text-muted">密碼至少需要6個字元，且包含至少一個字母和一個數字</small>
    </div>

    <div class="form-group">
      <label for="confirm_password">🔄 確認密碼</label>
      <input type="password" name="confirm_password" id="confirm_password" class="form-control" required>
    </div>

    <div class="cta slide-up delay-3">
      <button type="submit" class="btn btn-primary">註冊</button>
      <a href="{{ url_for('login') }}" class="btn btn-link">已有帳號？返回登入</a>
    </div>
  </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
document.getElementById('register-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password !== confirmPassword) {
        alert('兩次輸入的密碼不一致');
        document.getElementById('confirm_password').value = '';
        document.getElementById('confirm_password').focus();
        return;
    }
    
    const formData = new FormData(this);
    
    fetch('/register', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            window.location.href = '/verify?email=' + encodeURIComponent(document.getElementById('email').value);
        } else {
            return response.text().then(text => {
                throw new Error(text);
            });
        }
    })
    .catch(error => {
        alert(error.message);
    });
});

// 即時密碼驗證
document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const regex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/;
    
    if (!regex.test(password)) {
        this.setCustomValidity('密碼至少需要6個字元，且包含至少一個字母和一個數字');
    } else {
        this.setCustomValidity('');
    }
});

// 即時確認密碼驗證
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    if (this.value !== password) {
        this.setCustomValidity('兩次輸入的密碼不一致');
    } else {
        this.setCustomValidity('');
    }
});
</script>

<style>
.register-container {
  max-width: 400px;
  margin: 40px auto;
  padding: 20px;
  opacity: 0;  /* 設置初始狀態 */
  animation: fadeIn 0.5s ease-in forwards;
}

.form-group {
  margin-bottom: 20px;
}

.form-control {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-top: 5px;
}

.form-text {
  font-size: 12px;
  color: #6c757d;
  margin-top: 5px;
}

.btn-primary {
  width: 100%;
  padding: 10px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-bottom: 10px;
}

.btn-link {
  color: #007bff;
  text-decoration: none;
  display: block;
  text-align: center;
}

.btn-link:hover {
  text-decoration: underline;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    transform: translateY(20px); 
    opacity: 0; 
  }
  to { 
    transform: translateY(0); 
    opacity: 1; 
  }
}

.slide-up {
  opacity: 0;  /* 設置初始狀態 */
  animation: slideUp 0.5s ease-out forwards;
}

.delay-1 {
  animation-delay: 0.2s;
}

.delay-2 {
  animation-delay: 0.4s;
}

.delay-3 {
  animation-delay: 0.6s;
}
</style>
{% endblock %}
