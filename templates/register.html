{% extends "base.html" %}

{% block title %}è¨»å†Š{% endblock %}

{% block content %}
<div class="register-container">
  <h2 class="slide-up">ğŸ†• å»ºç«‹æ–°å¸³è™Ÿ</h2>
  <p class="slide-up delay-1">è«‹å¡«å¯«ä»¥ä¸‹è³‡è¨Šä»¥è¨»å†Šæ–°å¸³è™Ÿã€‚</p>

  <form id="register-form" method="POST" class="register-form slide-up delay-2">
    <div class="form-group">
      <label for="email">ğŸ“§ é›»å­éƒµä»¶</label>
      <input type="email" name="email" id="email" class="form-control" required>
    </div>

    <div class="form-group">
      <label for="password">ğŸ”‘ å¯†ç¢¼</label>
      <input type="password" name="password" id="password" class="form-control" required 
             minlength="6" pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$" 
             title="å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒï¼Œä¸”åŒ…å«è‡³å°‘ä¸€å€‹å­—æ¯å’Œä¸€å€‹æ•¸å­—">
      <small class="form-text text-muted">å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒï¼Œä¸”åŒ…å«è‡³å°‘ä¸€å€‹å­—æ¯å’Œä¸€å€‹æ•¸å­—</small>
    </div>

    <div class="form-group">
      <label for="confirm_password">ğŸ”„ ç¢ºèªå¯†ç¢¼</label>
      <input type="password" name="confirm_password" id="confirm_password" class="form-control" required>
    </div>

    <div class="cta slide-up delay-3">
      <button type="submit" class="btn btn-primary">è¨»å†Š</button>
      <a href="{{ url_for('login') }}" class="btn btn-link">å·²æœ‰å¸³è™Ÿï¼Ÿè¿”å›ç™»å…¥</a>
    </div>
  </form>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
document.getElementById('register-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    if (password !== confirmPassword) {
        alert('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´');
        document.getElementById('confirm_password').value = '';
        document.getElementById('confirm_password').focus();
        return;
    }
    
    const formData = new FormData(this);
    
    fetch('/register', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            window.location.href = '/verify?email=' + encodeURIComponent(document.getElementById('email').value);
        } else {
            return response.text().then(text => {
                throw new Error(text);
            });
        }
    })
    .catch(error => {
        alert(error.message);
    });
});

// å³æ™‚å¯†ç¢¼é©—è­‰
document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const regex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}$/;
    
    if (!regex.test(password)) {
        this.setCustomValidity('å¯†ç¢¼è‡³å°‘éœ€è¦6å€‹å­—å…ƒï¼Œä¸”åŒ…å«è‡³å°‘ä¸€å€‹å­—æ¯å’Œä¸€å€‹æ•¸å­—');
    } else {
        this.setCustomValidity('');
    }
});

// å³æ™‚ç¢ºèªå¯†ç¢¼é©—è­‰
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    if (this.value !== password) {
        this.setCustomValidity('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´');
    } else {
        this.setCustomValidity('');
    }
});
</script>

<style>
.register-container {
  max-width: 400px;
  margin: 40px auto;
  padding: 20px;
  opacity: 0;  /* è¨­ç½®åˆå§‹ç‹€æ…‹ */
  animation: fadeIn 0.5s ease-in forwards;
}

.form-group {
  margin-bottom: 20px;
}

.form-control {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  margin-top: 5px;
}

.form-text {
  font-size: 12px;
  color: #6c757d;
  margin-top: 5px;
}

.btn-primary {
  width: 100%;
  padding: 10px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  margin-bottom: 10px;
}

.btn-link {
  color: #007bff;
  text-decoration: none;
  display: block;
  text-align: center;
}

.btn-link:hover {
  text-decoration: underline;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    transform: translateY(20px); 
    opacity: 0; 
  }
  to { 
    transform: translateY(0); 
    opacity: 1; 
  }
}

.slide-up {
  opacity: 0;  /* è¨­ç½®åˆå§‹ç‹€æ…‹ */
  animation: slideUp 0.5s ease-out forwards;
}

.delay-1 {
  animation-delay: 0.2s;
}

.delay-2 {
  animation-delay: 0.4s;
}

.delay-3 {
  animation-delay: 0.6s;
}
</style>
{% endblock %}
